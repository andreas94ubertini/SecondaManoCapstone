@model SmCapstone.Models.Users

@{
    ViewBag.Title = "ProfilePage";
}
<div class="container">
    <div class="main-body py-5">
        <h2 class="text-center mb-3">Gestici il tuo profilo</h2>
        <div class="row gutters-sm">
            <div class="col-md-4 mb-3">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex flex-column align-items-center text-center">
                            <img src="~/Content/assets/profileImgs/@Model.Img" alt="Profile Image" class="rounded-circle" width="150">
                            <div class="mt-3">
                                <h4>@Model.Username</h4>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card mt-3">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
                            <p class="fs-5">Oggetti in vendita: @Model.Products.Count()<h3 />
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
                            <p class="fs-5">Recensioni Ricevute: @Model.Reviews.Count()<h3 />
                        </li>

                    </ul>
                </div>
            </div>
            <div class="col-md-8">
                <div class="card mb-3">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-sm-3">
                                <h6 class="mb-0">Nome</h6>
                            </div>
                            <div class="col-sm-9 text-secondary">
                                @Model.Name
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <h6 class="mb-0">Cognome</h6>
                            </div>
                            <div class="col-sm-9 text-secondary">
                                @Model.Surname
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <h6 class="mb-0">Email</h6>
                            </div>
                            <div class="col-sm-9 text-secondary">
                                @Model.Email
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <h6 class="mb-0">Iscritto dal:</h6>
                            </div>
                            <div class="col-sm-9 text-secondary">
                                @Model.Date.ToShortDateString()
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-12">
                                <a class="btn btn-success rounded-pill " target="__blank" href="/Users/EditUser">Modifica Profilo</a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row gutters-sm">
                    <div class="col-sm-12 mb-3">
                        <div class="card h-100">
                            <div class="card-body">
                                <p class="fs-5 text-center">Annunci Attivi</p>
                                <div id="carouselExampleControls" class="carousel carousel-dark slide carousel-fade " data-mdb-ride="carousel">
                                    <div class="carousel-inner">
                                        @if (Model.Products.Count > 0)
                                        {
                                            <div class="carousel-item active text-center">
                                                <div class="card">
                                                    <div class="card-body">
                                                        <h5 class="card-title">Oggetto: <strong>@Model.Products.FirstOrDefault().Name</strong></h5>
                                                        <p class="card-text">Prezzo: <strong>@Model.Products.FirstOrDefault().Price</strong></p>
                                                        <p class="card-text">Offerte Ricevute: <strong>@Model.Products.FirstOrDefault().Bids.Count()</strong></p>
                                                        <a href="/Post/ProductDetails/@Model.Products.FirstOrDefault().IdProduct" class="btn btn-primary">Mostra</a>
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                        else
                                        {
                                            <div class="carousel-item active text-center">
                                                <div class="card">
                                                    <div class="card-body">
                                                        <h5 class="card-title">Non ci sono annunci attivi</h5>
                                                        <p class="card-text">Inserisci un annuncio per visualizzarlo</p>
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                        @foreach (SmCapstone.Models.Products p in Model.Products)
                                        {
                                            if (p != @Model.Products.FirstOrDefault())
                                            {
                                                <div class="carousel-item text-center">
                                                    <div class="card">
                                                        <div class="card-body">
                                                            <h5 class="card-title">Oggetto: <strong>@p.Name</strong></h5>
                                                            <p class="card-text">Prezzo: <strong>@p.Price</strong></p>
                                                            <p class="card-text">Offerte Ricevute: <strong>@p.Bids.Count()</strong></p>
                                                            <a href="/Post/ProductDetails/@p.IdProduct" class="btn btn-primary">Mostra</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            }

                                        }
                                    </div>
                                    <button class="carousel-control-prev" type="button" data-mdb-target="#carouselExampleControls" data-mdb-slide="prev">
                                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                        <span class="visually-hidden">Previous</span>
                                    </button>
                                    <button class="carousel-control-next" type="button" data-mdb-target="#carouselExampleControls" data-mdb-slide="next">
                                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                        <span class="visually-hidden">Next</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row gutters-sm">
                    <div class="col-sm-12 mb-3">
                        <div class="card h-100">
                            <div class="card-body">
                                <p class="fs-5 text-center">Offerte Ricevute</p>
                            </div>
                            <div class="card-body d-flex flex-column">
                                <p class="m-0">Offerte Accettate</p>
                                @foreach (SmCapstone.Models.Bids b in Model.Bids)
                                {
                                    if (b.IsAccepted == true)
                                    {
                                        <p>Ti sei aggiudicato @b.Products.Name per @b.Price eur</p>
                                    }
                                }
                                @foreach (SmCapstone.Models.Products p in Model.Products)
                                {


                                    if (p.IsSold == false)
                                    {
                                        if (p.Bids.Count > 0)
                                        {
                                            <p>Il tuo annuncio per @p.Name</p>
                                            foreach (SmCapstone.Models.Bids b in p.Bids)
                                            {
                                                if (b.IsAccepted == null)
                                                {
                                                    <div class="card">
                                                        <div class="card-body">
                                                            <p>Offerta: @b.Price Eur</p>
                                                            <p>Messaggio: @b.Message</p>
                                                            <p>Proposta inviata da: @b.Users.Username</p>
                                                            <p>Data: @b.BidDate</p>
                                                            <p><a href="/Post/AcceptOffer/@b.IdBid" class="btn btn-success">Accetta</a></p>
                                                            <p><a href="/Post/DeclineOffer/@b.IdBid" class="btn btn-danger">Rifiuta</a></p>
                                                        </div>
                                                    </div>
                                                }
                                            }
                                        }
                                    }
                                }
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row gutters-sm">
                    <div class="col-sm-12 mb-3">
                        work
                        <div class="card h-100">
                            <div class="card-body">
                                <p class="fs-5 text-center">Tutte le offerte inviate</p>
                            </div>
                            <div class="card-body">
                                <p class="m-0">Offerte Inviate</p>
                                @foreach (SmCapstone.Models.Bids b in Model.Bids)
                                {


                                    if (b.Products.IsSold != true || b.IsAccepted == true)
                                    {
                                        <div class="card">

                                            <div class="card-body">
                                                @if (b.IsAccepted == true)
                                                {<p>
                                                        <span class="badge rounded-pill badge-success">Accettata</span>
                                                    </p>

                                                    foreach (SmCapstone.Models.Transactions t in b.Transactions)
                                                    {
                                                        if (t.IsPaid)
                                                        {


                                                            <p>Pagato ok</p>
                                                        }
                                                        else
                                                        {
                                                            <a class="btn btn-primary" href="/Post/CheckOut/@t.IdTransaction">Paga ora</a>
                                                        }
                                                    }



                                                }
                                                @if (b.IsAccepted == false && b.Products.IsSold != true)
                                                {<p><span class="badge rounded-pill badge-danger">Rifiutata</span></p>}
                                                @if (b.IsAccepted == null && b.Products.IsSold != true)
                                                {<p><span class="badge rounded-pill badge-primary">In Corso</span><a href="/Post/DeleteOffer/@b.IdBid">Elimina Offerta</a></p>}

                                                <h5 class="card-title">Oggetto: <strong>@b.Products.Name</strong></h5>
                                                <p class="card-text">Prezzo: <strong>@b.Price</strong></p>
                                                <p class="card-text">Data: <strong>@b.BidDate.ToShortDateString()</strong></p>
                                                <a href="/Post/ProductDetails/" class="btn btn-primary">Mostra</a>
                                            </div>
                                        </div>
                                    }

                                }
                            </div>
                        </div>
                    </div>
                </div>


            </div>



        </div>
    </div>

</div>
